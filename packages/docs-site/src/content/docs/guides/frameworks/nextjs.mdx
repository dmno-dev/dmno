---
title: Next.js
description: Using DMNO with Next.js
---

import Install from '@/components/Install.astro';


## Taking Next to the _next_ level with DMNO

If you have an existing Next.js app, you're probably already familiar with how environment variables work in Next. Check their docs [here](https://nextjs.org/docs/app/building-your-application/configuring/environment-variables) if you need a refresher. 

Now forget all of that, and let's simplify things with DMNO.

### Install dependencies

First, install the `@dmno/config-engine` and `@dmno/dmno-next` packages.

<Install packageName="@dmno/config-engine @dmno/dmno-cli @dmno/dmno-next" />

> TODO: DO WE NEED THE NEXT PLUGIN AT ALL? 

### Scaffold your DMNO config

Run the following command in a terminal at the root of your monorepo:

{/* TODO MULTIPLATFORM COMPONENT FOR GENERIC COMMANDS */}
```bash
npx dmno init
```

This will create a `.dmno` directory in the root of your project with a `workspace-config.mts` file. And it will also create `.dmno` folders in each of the other directories for other apps/services in your monorepo.

:::tip
If you don't have a monorepo (yet), you can always add child apps/services to your monorepo later via the `dmno add` command.
:::

### Configure your environment variables    

Open the `workspace-config.mts` file in the `.dmno` directory at the root of your monorepo and add your environment variables like so:

```typescript  
import {
  DmnoBaseTypes, defineWorkspaceConfig, configPath, toggleByEnv, dmnoFormula, asdf,
} from '@dmno/core';

export default defineWorkspaceConfig({
  schema: {
    // regular, defaults to string
    ENVVAR1,
    // with number type
    ENVVAR2: DmnoBaseTypes.number,
    // with boolean type
    ENVVAR3: DmnoBaseTypes.boolean,
    // with string type and additional constraints
    ENVVAR4: {
      extends: DmnoBaseTypes.string({
        minLength: 5,
        maxLength: 10,
      }),
      value: 'default value',
      required: true,
    },
  },
});
```

### Next.js specific features

If you're migrating from an existing Next.js app, you might have some environment variables that are specific to Next.js. For example, you might have a `NEXT_PUBLIC_` prefix for environment variables that are exposed to the browser.

Let's say you have a `NEXT_PUBLIC_API_URL` environment variable. You can add it to your `config.mts` file like so:

```typescript
import {
  DmnoBaseTypes, defineConfigSchema, configPath, toggleByEnv, dmnoFormula,
} from '@dmno/core';

export default defineConfigSchema({
  schema: {
    NEXT_PUBLIC_API_URL: DmnoBaseTypes.string,
  },
});
```

Or if you want to use items from your root config, you can make use of dmno's `pick` command to get those and use them in your Next.js app.

```typescript
import {
  DmnoBaseTypes, defineConfigSchema, configPath, toggleByEnv, dmnoFormula,
} from '@dmno/core';

export default defineConfigSchema({
  pick: [
    {
      key: ['ENVVAR1', 'ENVVAR2'],
      renameKey: ((k) => `NEXT_PUBLIC_${k}`),
    },
  ],
});
```

This will allow you to use the `ENVVAR1` and `ENVVAR2` environment variables in your Next.js app as `NEXT_PUBLIC_ENVVAR1` and `NEXT_PUBLIC_ENVVAR2`.

### Wiring it up in your Next.js config

Now that you have your environment variables set up, you can use them in your Next.js app.

Add the following to your `next.config.js` file:

```javascript
const withDmno = require('@dmno/dmno-next');

module.exports = {
  // your existing config
  env: { ...withDmno() },
};
```

Now your environment variables will be available in your Next.js app. Instead of using `process.env`, you can use `Dmno.get('NEXT_PUBLIC_ENVVAR1')`. 

For example: 

```tsx
import Dmno from '@dmno/dmno-next';

export default function Home()   {
  return (
    <div>
      <h1>Some env var: {Dmno.get('NEXT_PUBLIC_ENVVAR1')}</h1>
    </div>
  )
}
```

:::danger[Runtime vs. Buildtime]
The same rules still apply for runtime vs. buildtime. You can read more about that [here](https://nextjs.org/docs/app/building-your-application/configuring/environment-variables#runtime-environment-variables).
:::











